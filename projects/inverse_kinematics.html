<!DOCTYPE html>
<html>

	<head>

		<title>Justin Abel - Projects</title>

		<meta charset="UTF-8" />

		<!-- STYLE -->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<link href="../styles/navbar.css" rel="stylesheet" type="text/css">
		<link href="../styles/projects.css" rel="stylesheet" type="text/css">

		<!-- FONTS -->
		<link href="https://fonts.googleapis.com/css?family=Ubuntu&display=swap" rel="stylesheet">

	</head>

	<body>

		<nav class="navbar navbar-expand-sm sticky-top" style="padding: 0; background-color: white">
	    <ul class="navbar-nav">
				<li id="menu-title-box" class="nav-item">
			    <a id="menu-title" class="nav-link" href="../index.html">Justin Abel</a>
			  </li>
			  <li id="menu-item-1" class="nav-item">
			    <a class="nav-link" href="../index.html">Home</a>
			  </li>
			  <li id="menu-item-2" class="nav-item">
			    <a class="nav-link" href="../about.html">About</a>
			  </li>
			  <li id="menu-item-3" class="nav-item active">
			    <a class="nav-link" href="../projects.html">Projects</a>
			  </li>
	    </ul>
		</nav>

	  <div class="row justify-content-md-center align-items-center" style="margin: 30px 0;">
	    <div class="col-md-8">
	    	<div class="row justify-content-md-center align-items-center">
		    	<img src="../images/projects/robot_arm_obstacles.png" style="width: 40%;"/>
		    	<img src="../images/projects/robot_arm_no_obstacles.png" style="width: 40%;"/>
		    </div>
				<h1 class="project-title" style="margin: 40px 0;">Inverse Kinematics Using Optimization</h1>

				<p class="project-description"><b>Overview:</b> Through the use of function optimization in MATLAB, the position and orientation of a 3-dimensional snake robot is controlled in order to reach into an environment and grasp an object. The snake robot consists of a serial chain of kinematic links, of arbitrary number and length, where each joint is controlled with a set of Euler angles (roll, pitch, yaw). The environment is filled with spherical obstacles that the robot must avoid in reaching the obstacle.</p>

				<h1>Setup:</h1>
				<p class="project-description"><b>Objective:</b> Write a MATLAB program (part1.m) to position control the tip of the robot (end of the last link) to a specified location and orientation. The position is given as a set of Cartesian coordinates <code>[x, y, z]</code> while the orientation of the last link is given as a quaternion <code>[q0, q1, q2, q3]</code>.</p>

				<p class="project-description"><b><u>Function Inputs:</u></b></p>
				<ul class="project-description">
					<li>The target, given as <code>(x, y, z, q0, q1, q2, q3)</code></li>
					<li>A vector of link lengths (of size Nx1 for a total of N links)</li>
					<li>Limits on the roll, pitch, and yaw angles of each link</li>
					<li>A series of spherical obstacles given as <code>(x, y, z, radius)</code></li>
				</ul>

				<p class="project-description"><b><u>Function Outputs:</u></b></p>
				<ul class="project-description">
					<li>Roll, Pitch, and Yaw vectors for all N links to position the tip at the given target</li>
					<li>A graphical animation of the robot as it searches for the target</li>
				</ul>

				<div class="row">
					<div class="col-md-6">
						<img src="../images/projects/p1_home.png" style="width: 100%;"/>
						<p class="project-description" style="text-align: center;"><i>Home Position</i></p>
					</div>
					<div class="col-md-6">
						<img src="../images/projects/p1_orth.png" style="width: 100%;"/>
						<p class="project-description" style="text-align: center;"><i>Example Configuration That Reaches Target</i></p>
					</div>
				</div>

				<h1>Solving Inverse Kinematics:</h1>
				<p class="project-description">The actual optimization process was done using the function <b>fmincon</b> in MATLAB. Essentially, fmincon takes some initial set of joint angles for each link and continuously attempts to find a new set of angles that minimizes a cost function until a set of constraints (desired tip location and orientation) is achieved within a certain accuracy. Therefore, we must develop a cost function (criterion.m) that the program will attempt to minimize as well as a series of constraints (constraints.m) that must be obeyed in the optimization.</p>

				<p class="project-description"><b>part1.m</b> acts as the main function that initializes global variables for the desired target, link lengths, and the home position of the robot (to be used in the cost function). First, a variable <code>p0</code> is initialized with all zero Euler angles for all links to represent the home position which will be used as the initial set of angles for the optimization function. Next, the angle limit constraints are organized into lower and upper bounds (<code>lb</code> and <code>ub</code> respectively) for the matrix of joint angles to be passed into <b>fmincon</b>. Finally, the optimization function, <b>fmincon</b>, is called using the local function <b>criterion.m</b> as the objective cost function and the function <b>constraints.m</b> to specify the desired location and orientation constraints. The ‘interior-point’ algorithm is used as default with a maximum of 1000 function evaluations as shown below:</p>

				<p class="project-description">
					<b><code>options = optimset('Display','iter','MaxFunEvals',10000,'Algorithm','interior-point');</code></b>
				</p>
				<p class="project-description">
					<b><code>[answer,fval,exitflag]=fmincon(@criterion,p0,[],[],[],[],lb,ub,@constraints,options);</code></b>
				</p>

				<p class="project-description"><b>criterion.m</b> is the next function that is called by fmincon. This function takes in a matrix of Euler joint angles for each link and then performs Forward Kinematic calculations to derive the location and orientation of the last link using a function I wrote called <b>fk.m</b> (see description of fk.m below for more details). Now with the position of the last link, a cost function is created that calculates the square of the Euclidean distance between the tip and the desired location as well as the deviation of each joint angle from its home position (to encourage a solution that requires the least amount of link rotation/movement). A gain is multiplied by each of these two quantities before summing them as a way to tune the performance. I ended up applying a much larger gain to the squared Euclidean distance as it is more crucial and I found it decreased run time.</p>

				<p class="project-description"><b>constraints.m</b> is the second function that controls the optimization process of <b>fmincon</b>. Here, a series of nonlinear equality and inequality constraints are formulated that must be achieved within a given accuracy range before fmincon returns a minimum solution. The first four equality constraints are simply the location and orientation of the tip must equal the desired location and orientation. The current orientation is calculated as the vector along the link (x axis) and is compared to the given quaternion by first converting the quaternion to a rotation matrix (using MATLAB’s <b>quat2rotm</b> function) and then constraining the unit projection of the last link vector on the first column of the rotation matrix to be 1. The inequality constraints are used to ensure that the links do not intersect or collide with the spherical obstacles. Here, the link end points are constrained so that they do not fall within the bounds of each sphere. Below, are brief segments of code to demonstrate the various equality and inequality constraints.</p>

				<p class="project-description"><b><u>Equality Constraints:</u></b></p>
				<ul class="project-description">
					<li><code>eq_violations(1) = pos(end, 1) - x_d(1);</code></li>
					<li><code>eq_violations(2) = pos(end, 2) - x_d(2);</code></li>
					<li><code>eq_violations(3) = pos(end, 3) - x_d(3);</code></li>
					<li><code>rotm = quat2rotm(desired_quaternion_orientation');</code></li>
					<li><code>eq_violations(4) = sum((link_vec' - rotm(:,1)).^2);</code></li>
				</ul>

				<p class="project-description"><b><u>Inequality Constraints:</u></b></p>
				<ul class="project-description">
					<li><code>%Note: r= sphere radius, (x,y,z) = sphere center</code></li>
					<li><code>%Note: j = sphere number, k = link number</code></li>
					<li><code>ineq_violations((j-1)*length(l)+k) = r^2 - (pos(k,1)-x)^2 - (pos(k,2)-y)^2 - (pos(k,3)-z)^2;</code></li>
				</ul>







			</div>
		</div>


	</body>

</html>
